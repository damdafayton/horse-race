{"version":3,"sources":["components/WinnerModal.module.scss","features/horses/Horses.module.scss","config.js","app/api.js","features/horses/horsesSlice.js","app/store.js","components/WinnerModal.js","gif/l1.gif","gif/l2.gif","gif/l_miracle.gif","gif/r1.gif","gif/r2.gif","gif/r3.gif","features/horses/Horses.js","App.js","index.js"],"names":["module","exports","URL","configuration","API_URL","API_ENDPOINT_FOR_REDUX","API_URL_FOR_SOCKET","SOCKET_START_MESSAGE","SOCKET_TICKER_MESSAGE","MAX_DISTANCE","config","dataApi","createApi","reducerPath","baseQuery","fetchBaseQuery","baseUrl","endpoints","builder","raceData","query","onCacheEntryAdded","arg","updateCachedData","cacheDataLoaded","cacheEntryRemoved","socket","io","on","emit","message","draft","push","off","useRaceDataQuery","initialState","maxWidth","isRaceEnded","latestRaceData","undefined","winner","horsesSlice","createSlice","name","reducers","updateLatestRaceData","state","action","payload","zoomIn","zoomOut","endTheRace","setWinner","actions","store","configureStore","reducer","horsesReducer","middleware","getDefault","concat","WinnerModal","useSelector","horses","className","styles","container","toUpperCase","alt","gif","src","Horses","data","dispatch","useDispatch","l1","style","l2","lMiracle","r1","r2","r3","useEffect","length","lastData","filter","horse","distance","indexOf","setTimeout","map","idx","names","marginLeft","App","useWindowSize","width","height","type","onClick","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.4e3f89dd.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"WinnerModal_container__260aH\",\"gif\":\"WinnerModal_gif__3mnTx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"horses\":\"Horses_horses__1rnSf\",\"rotateHorse\":\"Horses_rotateHorse__XBJ_V\",\"names\":\"Horses_names__313sw\",\"gif\":\"Horses_gif__1qRC0\"};","const URL =\n  process.env.NODE_ENV === 'production'\n    ? 'https://horse-racing-server.herokuapp.com/'\n    : 'http://localhost:3002/';\n\nconst configuration = {\n  // Setup for mocking library\n  API_URL: URL,\n  API_ENDPOINT_FOR_REDUX: 'api',\n  API_URL_FOR_SOCKET: process.env.NODE_ENV === 'test' ? '' : URL,\n  SOCKET_START_MESSAGE: 'start',\n  SOCKET_TICKER_MESSAGE: 'ticker',\n  MAX_DISTANCE: process.env.NODE_ENV === 'production' ? 1000 : 1000,\n};\n\nexport default configuration;\n","import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';\nimport { io } from 'socket.io-client';\n\nimport config from '../config';\n\nconst {\n  API_URL,\n  SOCKET_TICKER_MESSAGE,\n  API_ENDPOINT_FOR_REDUX,\n  API_URL_FOR_SOCKET,\n  SOCKET_START_MESSAGE,\n} = config;\n\nexport const dataApi = createApi({\n  reducerPath: 'dataApi',\n  baseQuery: fetchBaseQuery({ baseUrl: API_URL }),\n  endpoints: (builder) => ({\n    raceData: builder.query({\n      query: () => API_ENDPOINT_FOR_REDUX,\n      async onCacheEntryAdded(\n        arg,\n        { updateCachedData, cacheDataLoaded, cacheEntryRemoved }\n      ) {\n        // I commented but didnt delete console.logs for documentation purpose\n        // console.log(`Making request for the first time in a while`);\n\n        let socket;\n        try {\n          await cacheDataLoaded;\n          // console.log('http server connected');\n\n          socket = io(API_URL_FOR_SOCKET);\n\n          socket.on('connect', () => {\n            // console.log('socket connected');\n            socket.emit(SOCKET_START_MESSAGE);\n          });\n\n          socket.on(SOCKET_TICKER_MESSAGE, (message) => {\n            // console.log('ticker emitted');\n\n            updateCachedData((draft) => {\n              draft.push(message);\n            });\n          });\n        } catch (error) {\n          // console.log({ error });\n        }\n        await cacheEntryRemoved;\n\n        socket.off();\n\n        // console.log(`No component subscribed to the data for a while`);\n      },\n    }),\n  }),\n});\n\nexport const { useRaceDataQuery } = dataApi;\n","import { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  maxWidth: 15,\n  isRaceEnded: false,\n  latestRaceData: undefined,\n  winner: undefined,\n};\n\nexport const horsesSlice = createSlice({\n  name: 'horses',\n  initialState,\n  reducers: {\n    updateLatestRaceData: (state, action) => {\n      state.latestRaceData = action.payload;\n    },\n    zoomIn: (state) => {\n      state.maxWidth += 1;\n    },\n    zoomOut: (state) => {\n      state.maxWidth -= 1;\n    },\n    endTheRace: (state) => {\n      state.isRaceEnded = true;\n    },\n    setWinner: (state, action) => {\n      state.winner = action.payload;\n    },\n  },\n});\n\n// Action creators are generated for each case reducer function\nexport const { updateLatestRaceData, zoomIn, zoomOut, endTheRace, setWinner } =\n  horsesSlice.actions;\n\nexport default horsesSlice.reducer;\n","import { configureStore } from '@reduxjs/toolkit';\n\nimport { dataApi } from './api';\nimport horsesReducer from '../features/horses/horsesSlice';\n\nexport const store = configureStore({\n  reducer: {\n    [dataApi.reducerPath]: dataApi.reducer,\n    horses: horsesReducer,\n  },\n  middleware: (getDefault) => getDefault().concat(dataApi.middleware),\n});\n","import { useSelector } from 'react-redux/es/exports';\n\nimport styles from './WinnerModal.module.scss';\n\nexport default function WinnerModal() {\n  const { winner } = useSelector((state) => state.horses);\n\n  return (\n    winner && (\n      <section className={styles.container}>\n        <div className=\"mt-3 d-flex flex-column align-items-center\">\n          <h1 className=\"fs-4 text-center text-primary\">WINNER</h1>\n          <h1 className=\"mb-5 mt-2 text-center\">{winner.name.toUpperCase()}</h1>\n          <img alt=\"winner\" className={styles.gif} src={winner.gif} />\n        </div>\n      </section>\n    )\n  );\n}\n","export default __webpack_public_path__ + \"static/media/l1.8ba713ae.gif\";","export default __webpack_public_path__ + \"static/media/l2.826e2d8e.gif\";","export default __webpack_public_path__ + \"static/media/l_miracle.dfb40033.gif\";","export default __webpack_public_path__ + \"static/media/r1.662feb6e.gif\";","export default __webpack_public_path__ + \"static/media/r2.3a353552.gif\";","export default __webpack_public_path__ + \"static/media/r3.7a54ba2a.gif\";","import { useEffect } from 'react';\n\nimport { useSelector, useDispatch } from 'react-redux/es/exports';\n\nimport { useRaceDataQuery } from '../../app/api';\nimport { endTheRace, updateLatestRaceData, setWinner } from './horsesSlice';\nimport styles from './Horses.module.scss';\nimport l1 from '../../gif/l1.gif';\nimport l2 from '../../gif/l2.gif';\nimport lMiracle from '../../gif/l_miracle.gif';\nimport r1 from '../../gif/r1.gif';\nimport r2 from '../../gif/r2.gif';\nimport r3 from '../../gif/r3.gif';\nimport config from '../../config';\n\nconst { MAX_DISTANCE } = config;\n\nexport default function Horses() {\n  const { data } = useRaceDataQuery();\n\n  const { maxWidth, latestRaceData, isRaceEnded } = useSelector(\n    (state) => state.horses\n  );\n\n  const dispatch = useDispatch();\n\n  const horses = [\n    {\n      gif: l1,\n      style: 'rotateHorse',\n    },\n    { gif: l2, style: 'rotateHorse' },\n    {\n      gif: lMiracle,\n      style: 'rotateHorse',\n    },\n    {\n      gif: r1,\n      style: 'horses',\n    },\n    {\n      gif: r2,\n      style: 'horses',\n    },\n    {\n      gif: r3,\n      style: 'horses',\n    },\n  ];\n\n  useEffect(() => {\n    if (isRaceEnded || !data || !data.length) {\n      return;\n    }\n\n    const lastData = data[data.length - 1];\n\n    let [winner] = lastData.filter((horse) => horse.distance >= MAX_DISTANCE);\n\n    // If any horse ends the race dont update latest data anymore.\n    // So horses will stop.\n    if (winner) {\n      // Add gif and styling data\n      winner = { ...winner, ...horses[lastData.indexOf(winner)] };\n\n      dispatch(endTheRace());\n      // Delay the result for transition to complete\n      setTimeout(() => dispatch(setWinner(winner)), 3000);\n      return;\n    }\n\n    dispatch(updateLatestRaceData(lastData));\n  }, [data]);\n\n  return (\n    <section className=\"mb-3\">\n      <div className=\"d-flex flex-column text-start\">\n        {latestRaceData ? (\n          latestRaceData.map((horse, idx) => (\n            <div key={`${horse.name}`}>\n              <h2 className={styles.names}>{horse.name}</h2>\n              <img\n                alt=\"horse\"\n                src={horses[idx].gif}\n                style={{\n                  maxWidth: `${maxWidth}vw`,\n                  // 3 vw space left to not trigger horizontal scroll bar in case vertical scroolbar is visible\n                  marginLeft: `${\n                    ((100 - maxWidth) * horse.distance) / MAX_DISTANCE - 3\n                  }vw`,\n                }}\n                className={styles[horses[idx].style]}\n              />\n            </div>\n          ))\n        ) : (\n          <div className=\"text-center\">\n            It takes 20 to 40 seconds to receive initial data from Heroku\n            server. Please wait..\n          </div>\n        )}\n      </div>\n    </section>\n  );\n}\n","import { useDispatch, useSelector } from 'react-redux/es/exports';\nimport ZoomInOutlinedIcon from '@mui/icons-material/ZoomInOutlined';\nimport ZoomOutOutlinedIcon from '@mui/icons-material/ZoomOutOutlined';\nimport useWindowSize from 'react-use/lib/useWindowSize';\nimport Confetti from 'react-confetti';\n\nimport WinnerModal from './components/WinnerModal';\nimport Horses from './features/horses/Horses';\nimport { zoomIn, zoomOut } from './features/horses/horsesSlice';\n\nfunction App() {\n  const dispatch = useDispatch();\n  const { winner } = useSelector((state) => state.horses);\n  const { width, height } = useWindowSize();\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header py-2 position-relative mb-3 px-4\">\n        <h1 className=\"fs-5 my-0 py-0\">HORSE RACING</h1>\n        <span className=\"position-absolute end-0 gap-2 \">\n          <button\n            type=\"button\"\n            className=\"btn-clean text-white me-2\"\n            onClick={() => dispatch(zoomIn())}\n          >\n            <ZoomInOutlinedIcon className=\"h-2rem\" />\n          </button>\n          <button\n            type=\"button\"\n            className=\"btn-clean text-white me-4\"\n            onClick={() => dispatch(zoomOut())}\n          >\n            <ZoomOutOutlinedIcon className=\"h-2rem\" />\n          </button>\n        </span>\n      </header>\n      <main>\n        <Horses />\n      </main>\n      {winner && (\n        <>\n          <Confetti width={width - 30} height={height} />\n          <WinnerModal />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { Provider } from 'react-redux';\n\nimport { store } from './app/store';\nimport './index.css';\nimport './bootstrap';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}